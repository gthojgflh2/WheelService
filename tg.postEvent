<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spamlordy | –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–ê–®–ò –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        /* ... (–≤–µ—Å—å –≤–∞—à CSS –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º –∂–µ) ... */
    </style>
</head>
<body>
<!-- –í–ï–°–¨ –í–ê–® HTML –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô -->
<div class="container">
    <!-- ... -->
</div>

<script>
    let tg = window.Telegram.WebApp;
    
    console.log('Telegram WebApp version:', tg.version);
    console.log('Platform:', tg.platform);
    console.log('Init data:', tg.initData); // –î–æ–±–∞–≤–∏–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    tg.ready();
    tg.expand();
    
    let userId = null;
    let spinType = 'free';
    let canSpin = true;
    let extraSpins = 0;
    let isSpinning = false;
    let totalSpins = 0;
    let currentRotation = 0;
    
    // –ü—Ä–∏–∑—ã
    const prizes = [
        { name: '1 –ß–ê–°', value: 60, color: '#FF6B6B', emoji: '‚è±Ô∏è', displayName: '1 —á–∞—Å', weight: 30 },
        { name: '2 –ß–ê–°–ê', value: 120, color: '#4ECDC4', emoji: '‚è±Ô∏è', displayName: '2 —á–∞—Å–∞', weight: 20 },
        { name: '3 –ß–ê–°–ê', value: 180, color: '#45B7D1', emoji: '‚è±Ô∏è', displayName: '3 —á–∞—Å–∞', weight: 15 },
        { name: '6 –ß–ê–°–û–í', value: 360, color: '#96CEB4', emoji: '‚è±Ô∏è', displayName: '6 —á–∞—Å–æ–≤', weight: 5 },
        { name: '2 –°–õ–û–¢–ê', value: 2, color: '#FFE194', emoji: 'üß©', displayName: '2 —Å–ª–æ—Ç–∞', weight: 2 },
        { name: '–õ–û–¢–ï–†–ï–Ø', value: 1, color: '#D4A5A5', emoji: 'üé∞', displayName: '–õ–æ—Ç–µ—Ä–µ—è', weight: 4 },
        { name: '+1', value: 1, color: '#9B59B6', emoji: '‚ú®', displayName: '+1 –ø—Ä–æ–∫—Ä—É—Ç', weight: 8 },
        { name: '–ü–†–û–ú–û', value: 50, color: '#F1C40F', emoji: 'üéüÔ∏è', displayName: '–ü—Ä–æ–º–æ–∫–æ–¥', weight: 1 },
        { name: '25 –ì–†–ù', value: 25, color: '#E67E22', emoji: 'üí∞', displayName: '25 –≥—Ä–Ω', weight: 12 },
        { name: '50 –ì–†–ù', value: 50, color: '#2ECC71', emoji: 'üí∞', displayName: '50 –≥—Ä–Ω', weight: 3 }
    ];
    
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';
    
    // –§—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
    function drawWheel(rotation = 0) {
        // ... (–≤–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è drawWheel –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    }
    
    function adjustColor(color, percent) {
        // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    }
    
    function fillPrizesGrid() {
        // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    }
    
    function togglePrizes() {
        const grid = document.getElementById('prizesGrid');
        grid.classList.toggle('visible');
    }
    
    function getUrlParams() {
        try {
            const params = new URLSearchParams(window.location.search);
            userId = params.get('user');
            const canSpinFree = params.get('canSpin') === 'true';
            extraSpins = parseInt(params.get('extraSpins') || '0');
            canSpin = canSpinFree;
            
            console.log('User ID from URL:', userId);
            console.log('Can spin free:', canSpinFree);
            console.log('Extra spins:', extraSpins);
            
            document.getElementById('freeBadge').innerHTML = `
                <span>üÜì</span>
                <span>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</span>
                <span>${canSpinFree ? '‚úÖ' : '‚ùå'}</span>
            `;
            document.getElementById('extraBadge').innerHTML = `
                <span>‚ú®</span>
                <span>–î–æ–ø. –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</span>
                <span>${extraSpins}</span>
            `;
            
            loadStats();
            updateSpinButton();
            drawWheel(currentRotation);
        } catch (e) {
            console.error('Error parsing URL params:', e);
        }
    }
    
    function loadStats() {
        try {
            if (userId) {
                const saved = localStorage.getItem(`wheel_${userId}`);
                if (saved) totalSpins = parseInt(saved) || 0;
            }
            document.getElementById('totalSpins').textContent = totalSpins;
            document.getElementById('freeSpins').textContent = canSpin ? '1' : '0';
            document.getElementById('extraSpins').textContent = extraSpins;
        } catch (e) {
            console.error('Error loading stats:', e);
        }
    }
    
    function saveStats() {
        try {
            if (userId) {
                localStorage.setItem(`wheel_${userId}`, totalSpins.toString());
            }
        } catch (e) {
            console.error('Error saving stats:', e);
        }
    }
    
    function updateSpinButton() {
        const btn = document.getElementById('spinBtn');
        if (canSpin) {
            btn.innerHTML = 'üé° –ö—Ä—É—Ç–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ';
            spinType = 'free';
            btn.disabled = false;
        } else if (extraSpins > 0) {
            btn.innerHTML = `‚ú® –ö—Ä—É—Ç–∏—Ç—å (–æ—Å—Ç–∞–ª–æ—Å—å ${extraSpins})`;
            spinType = 'extra';
            btn.disabled = false;
        } else {
            btn.innerHTML = '‚ùå –ù–µ—Ç –ø—Ä–æ–∫—Ä—É—Ç–æ–≤';
            btn.disabled = true;
        }
    }
    
    function getRandomPrize() {
        const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
        let random = Math.random() * totalWeight;
        
        let sum = 0;
        for (let i = 0; i < prizes.length; i++) {
            sum += prizes[i].weight;
            if (random < sum) {
                console.log(`‚úÖ Selected: ${prizes[i].name} (index ${i}, weight ${prizes[i].weight})`);
                return {
                    index: i,
                    prize: prizes[i],
                    rotation: currentRotation + (Math.PI * 2 * 10) + (i * (Math.PI * 2 / prizes.length))
                };
            }
        }
        return { index: 0, prize: prizes[0], rotation: currentRotation + Math.PI * 2 * 10 };
    }
    
    function getDescription(name) {
        const desc = {
            '1 –ß–ê–°': '‚úÖ +60 –º–∏–Ω—É—Ç –¥–æ—Å—Ç—É–ø–∞',
            '2 –ß–ê–°–ê': '‚úÖ +120 –º–∏–Ω—É—Ç –¥–æ—Å—Ç—É–ø–∞',
            '3 –ß–ê–°–ê': '‚úÖ +180 –º–∏–Ω—É—Ç –¥–æ—Å—Ç—É–ø–∞',
            '6 –ß–ê–°–û–í': '‚úÖ +360 –º–∏–Ω—É—Ç –¥–æ—Å—Ç—É–ø–∞',
            '2 –°–õ–û–¢–ê': '‚úÖ +2 —Å–ª–æ—Ç–∞ –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏',
            '–õ–û–¢–ï–†–ï–Ø': 'üé∞ –ë–∏–ª–µ—Ç –≤ –ª–æ—Ç–µ—Ä–µ—é',
            '+1': '‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–∫—Ä—É—Ç',
            '–ü–†–û–ú–û': 'üéü –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ 50 –≥—Ä–Ω',
            '25 –ì–†–ù': 'üí∞ 25 –≥—Ä–Ω –Ω–∞ –±–∞–ª–∞–Ω—Å',
            '50 –ì–†–ù': 'üí∞ 50 –≥—Ä–Ω –Ω–∞ –±–∞–ª–∞–Ω—Å'
        };
        return desc[name] || '–ü—Ä–∏–∑ –ø–æ–ª—É—á–µ–Ω!';
    }
    
    function spinWheel() {
        if (isSpinning) return;
        
        if (spinType === 'free' && !canSpin) {
            console.log('‚ùå –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Ä—É—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');
            return;
        }
        if (spinType === 'extra' && extraSpins <= 0) {
            console.log('‚ùå –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–∫—Ä—É—Ç–æ–≤');
            return;
        }
        
        isSpinning = true;
        document.getElementById('spinBtn').disabled = true;
        
        const result = getRandomPrize();
        const startRotation = currentRotation;
        const targetRotation = result.rotation;
        const startTime = performance.now();
        const duration = 4000;
        
        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const easeProgress = 1 - Math.pow(1 - progress, 4);
            currentRotation = startRotation + (targetRotation - startRotation) * easeProgress;
            
            drawWheel(currentRotation);
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                console.log('üéØ –í–´–ò–ì–†–´–®:', result.prize.name);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                document.getElementById('prizeInfo').innerHTML = `
                    <div class="prize-info-main">üéâ ${result.prize.emoji} ${result.prize.displayName}!</div>
                    <div class="prize-info-sub">${getDescription(result.prize.name)}</div>
                `;
                
                // –§–û–†–ú–ò–†–£–ï–ú –î–ê–ù–ù–´–ï
                const data = {
                    type: spinType,
                    prize: {
                        name: result.prize.name,
                        value: result.prize.value
                    }
                };
                
                // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ß–ï–†–ï–ó TELEGRAM
                const jsonData = JSON.stringify(data);
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞:', jsonData);
                
                // –í–ê–ñ–ù–û: sendData() –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é
                tg.sendData(jsonData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                totalSpins++;
                document.getElementById('totalSpins').textContent = totalSpins;
                
                if (spinType === 'free') {
                    canSpin = false;
                    document.getElementById('freeBadge').innerHTML = `
                        <span>üÜì</span>
                        <span>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</span>
                        <span>‚ùå</span>
                    `;
                    document.getElementById('freeSpins').textContent = '0';
                } else {
                    extraSpins--;
                    document.getElementById('extraBadge').innerHTML = `
                        <span>‚ú®</span>
                        <span>–î–æ–ø. –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</span>
                        <span>${extraSpins}</span>
                    `;
                    document.getElementById('extraSpins').textContent = extraSpins;
                }
                
                saveStats();
                updateSpinButton();
                isSpinning = false;
                
                // –ü–û–ö–ê–ó–´–í–ê–ï–ú –°–û–û–ë–©–ï–ù–ò–ï –û–ë –£–°–ü–ï–•–ï
                setTimeout(() => {
                    alert('‚úÖ –ü—Ä–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞.');
                }, 500);
            }
        }
        
        requestAnimationFrame(animate);
    }
    
    function closeApp() {
        tg.close();
    }
    
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    fillPrizesGrid();
    getUrlParams();
    drawWheel();
    
    window.addEventListener('resize', () => drawWheel(currentRotation));
    
    // –î–û–ë–ê–í–õ–Ø–ï–ú –û–ë–†–ê–ë–û–¢–ß–ò–ö –°–û–ë–´–¢–ò–ô
    tg.onEvent('mainButtonClicked', function() {
        console.log('Main button clicked');
    });
    
    console.log('WebApp –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
</script>
</body>
</html>
